{% extends 'base.html' %}

{% block title %}Lista de Membros{% endblock %}

{% block extra_css %}
    {{ block.super }}
{% endblock %}

{% block content %}
    <div class="container py-4 flex-grow-1">
        <div class="d-flex flex-wrap align-items-center justify-content-between mb-4 gap-2">
            <div class="flex-grow-1">
                <h2 class="mb-0">Lista de Membros</h2>
            </div>

            <div class="d-flex col-5 align-items-center gap-2 flex-shrink-1">
                <h4 class="mb-0">Localizar</h4>
                <div class="position-relative w-100">
                    <input id="filtro-nome" type="text" class="form-control pe-5" placeholder="Digite o nome"
                           autocomplete="off">
                    <i class="bi bi-search position-absolute top-50 end-0 translate-middle-y me-3 text-muted"></i>
                </div>
            </div>

        </div>
    </div>
    <div class="container py-4">
        <table class="table" id="tabela-membros">
            <thead class="">
            <tr>
                <th scope="col">Nome</th>
                <th scope="col">Telefone</th>
                <th scope="col" class="text-center">Ações</th>
            </tr>
            </thead>
            <tbody>
            {% for pessoa in pessoas %}
                <tr>
                    <td>{{ pessoa.nome }}</td>
                    <td>
                        {{ pessoa.telefone }}
                    </td>
                    <td class="text-center">
                        <!-- Dropdown de ações -->
                        <button
                                class="btn btn-sm btn-outline-secondary dropdown-toggle"
                                type="button"
                                id="acoesDropdown{{ pessoa.id }}"
                                data-bs-toggle="dropdown"
                                data-bs-boundary="viewport"
                                data-bs-display="dynamic"
                                data-bs-offset="0,4"
                        >
                            &hellip;
                        </button>
                        <ul
                                class="dropdown-menu dropdown-menu-end px-3"
                                aria-labelledby="acoesDropdown{{ pessoa.id }}"
                                data-bs-boundary="viewport"
                                data-bs-display="dynamic"
                        >

                            <li>
                                <a class="dropdown-item text-primary" href="{% url 'exibir' pessoa.id %}">
                                    <i class="bi bi-eye me-2"></i> Exibir dados
                                </a>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            {# Item: Editar #}
                            <li>
                                <a class="dropdown-item" href="{% url 'editar_membro' pessoa.id %}">
                                    <i class="bi bi-pencil me-2"></i> Editar
                                </a>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            {# Item: Marcar Presença #}
                            <li>
                                <a class="dropdown-item" {#href="{% url 'marcar_presenca' pessoa.id %}"#}>
                                    <i class="bi bi-trash me-2"></i> Excluir Membro
                                </a>
                            </li>
                        </ul>
                </div>
                </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="4" class="text-center text-muted">Nenhum membro encontrado.</td>
                </tr>
            {% endfor %}
    </tbody>
    </table>
    <script>
        window.addEventListener('load', function () {
            const input = document.getElementById('filtro-nome');
            const tabela = document.getElementById('tabela-membros');

            console.log('input?', input);
            console.log('tabela?', tabela);

            if (!input || !tabela) return;

            const linhas = tabela.tBodies[0].rows;
            console.log('linhas:', linhas.length);

            input.addEventListener('input', function () {
                const filtro = this.value.trim().toLowerCase();
                Array.from(linhas).forEach(row => {
                    const nome = (row.cells[0]?.innerText || '').toLowerCase();
                    row.style.display = nome.includes(filtro) ? '' : 'none';
                });
            });
        });
    </script>
    </div>
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const input = document.getElementById("filtro-nome");

            input.addEventListener("input", function () {
                const filtro = input.value.trim().toLowerCase();

                // Pegando novamente as linhas atualizadas
                const linhas = document.querySelectorAll("table tbody tr");

                linhas.forEach((linha) => {
                    const nome = linha.querySelector("td");
                    if (!nome) return; // ignora se não achar a célula

                    const nomeTexto = nome.innerText.trim().toLowerCase();

                    if (nomeTexto.includes(filtro)) {
                        linha.style.display = "";
                    } else {
                        linha.style.display = "none";
                    }
                });
            });
        });
    </script>
{% endblock %}


